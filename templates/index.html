<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ã‚¢ãƒ³ã‚°ãƒ©ãƒ¼è¨ºæ–­</title>
    <style>
        body { 
            background: #000b1a; color: #00ffff; text-align: center; 
            font-family: sans-serif; margin: 0; padding: 10px;
        }
        h1 { font-size: 1.4rem; margin: 10px 0; }
        
        /* ã‚«ãƒ¡ãƒ©ãƒ»å†™çœŸè¡¨ç¤ºã‚¨ãƒªã‚¢ */
        .container { position: relative; width: 280px; height: 350px; margin: 0 auto; background: #000; border: 2px solid #00ffff; border-radius: 10px; overflow: hidden; }
        video, canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
        canvas { display: none; z-index: 5; } /* æ’®å½±ã—ãŸå†™çœŸç”¨ */

        /* ã‚¹ã‚­ãƒ£ãƒ³ç·š */
        .scan-line { position: absolute; top: 0; left: 0; width: 100%; height: 3px; background: #fff; box-shadow: 0 0 10px #00ffff; z-index: 10; display: none; animation: scan 1.5s infinite; }
        @keyframes scan { 0% { top: 0; } 50% { top: 100%; } 100% { top: 0; } }

        /* ãƒœã‚¿ãƒ³ */
        .btn { background: #ff4136; color: #fff; padding: 12px 30px; border-radius: 50px; border: none; font-weight: bold; margin-top: 15px; cursor: pointer; }
        .save-hint { font-size: 0.7rem; color: #88ffff; margin-top: 5px; display: none; }

        /* çµæœãƒ†ã‚­ã‚¹ãƒˆã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼ˆå†™çœŸã®ä¸Šã«è¼‰ã›ã‚‹ï¼‰ */
        .result-overlay {
            position: absolute; bottom: 0; left: 0; width: 100%;
            background: rgba(0, 0, 0, 0.6); color: #fff; padding: 10px;
            font-size: 0.8rem; text-align: left; box-sizing: border-box;
            z-index: 15; display: none; border-top: 1px solid #00ffff;
        }
    </style>
</head>
<body>
    <h1>ğŸ£ ã‚¢ãƒ³ã‚°ãƒ©ãƒ¼è¨ºæ–­</h1>
    
    <div class="container" id="captureArea">
        <video id="video" autoplay playsinline></video>
        <canvas id="canvas"></canvas>
        <div id="scanLine" class="scan-line"></div>
        <div id="resultOverlay" class="result-overlay"></div>
    </div>

    <button id="snap" class="btn">é©æ­£ã‚’ã‚¹ã‚­ãƒ£ãƒ³</button>
    <div id="saveHint" class="save-hint">â€»å†™çœŸã‚’é•·æŠ¼ã—ã§ä¿å­˜ã§ãã‚‹ãï¼</div>

    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const resultOverlay = document.getElementById('resultOverlay');
        const scanLine = document.getElementById('scanLine');
        const snapBtn = document.getElementById('snap');
        const saveHint = document.getElementById('saveHint');

        navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } })
            .then(s => video.srcObject = s);

        snapBtn.addEventListener('click', () => {
            // ã‚¹ã‚­ãƒ£ãƒ³æ¼”å‡º
            scanLine.style.display = 'block';
            snapBtn.disabled = true;
            resultOverlay.style.display = 'none';
            canvas.style.display = 'none';

            // è¨ºæ–­ãƒ‡ãƒ¼ã‚¿å–å¾—
            fetch('/analyze', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({}) })
            .then(r => r.json())
            .then(data => {
                setTimeout(() => {
                    // å†™çœŸã‚’æ’®ã‚‹
                    const ctx = canvas.getContext('2d');
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    ctx.drawImage(video, 0, 0);

                    // è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
                    canvas.style.display = 'block';
                    scanLine.style.display = 'none';
                    resultOverlay.innerText = data.result;
                    resultOverlay.style.display = 'block';
                    saveHint.style.display = 'block';
                    snapBtn.innerText = "ã‚‚ã†ä¸€åº¦ã‚¹ã‚­ãƒ£ãƒ³";
                    snapBtn.disabled = false;
                }, 2000);
            });
        });
    </script>
</body>
</html>
