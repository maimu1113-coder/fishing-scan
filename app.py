import random
from flask import Flask, render_template, request, jsonify

app = Flask(__name__)

# 属性パーツ
styles = ["殺気を隠せない", "リリースが早すぎる", "根掛かりを恐れない", "時合に命をかける", "ドラグ音が大好物な", "バックラッシュの天才", "防波堤と化した", "キャストが美しすぎる", "魚より道具を愛する", "潮目に敏感すぎる", "生餌を疑わない", "常にボウズ覚悟の"]
# 称号パーツ
jobs = ["ショアジギ狂い", "エサ取りの名手", "ランガンジャンキー", "堤防の守護神", "ルアー紛失職人", "週末限定テスター", "キャスティング魔術師", "釣具屋の常連客", "タモ入れ失敗のプロ", "ポイント開拓者", "外道ハンター", "居残り釣行の鬼"]

# 仙人の毒舌コメント（1000パターン以上のバリエーションの核）
comments = [
    "お前の殺気で、半径50mの魚が散っておるぞ。まずは深呼吸じゃ。",
    "根掛かりを『魚の反応』と言い張るのは、もう卒業するんじゃな。",
    "お前のルアーボックス、全部一軍に見えて、実はベンチ入りすら怪しいぞ。",
    "『今日は潮が悪い』。その言葉、お前はもう一生分使ったぞ。",
    "釣具屋のポイントカードの溜まり具合だけは、プロ級じゃのう。",
    "魚を釣る前に、自分の服のフックを外す練習をせい。",
    "朝マズメに寝坊したショックで、一日中魂が抜けとるな。",
    "お前のライフジャケット、オシャレじゃが、中身（腕前）が伴っておらんのう。",
    "隣の人が釣れた時に『タナは何ですか？』と聞く時の顔、必死すぎて怖いぞ。",
    "魚が跳ねただけで『ナブラだ！』と叫ぶのはやめなさい。あれはボラじゃ。",
    "お前のキャスト精度、魚を狙うより電線を狙う方が向いとるな。",
    "新しいロッドを買ったことを家族に隠しとるな？ 魚にはバレとるぞ。"
]

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/analyze', methods=['POST'])
def analyze():
    score = random.randint(0, 120)
    rare_chance = random.random()
    
    # 1%の確率で「神引き」演出
    if rare_chance < 0.01:
        title = "✨ 伝説の釣り神（レジェンド） ✨"
        score = 999
        advice = "おぬし…もはや説明不要。水面に立つだけで魚が跳ね上がってくるレベルじゃ。今すぐプロに転向せい！"
    elif score >= 110:
        title = f"【究極】{random.choice(styles)}人魚"
        advice = "適正が高すぎて、もう半分魚になっておるぞ。陸にいるのが不思議なレベルじゃ。"
    else:
        title = f"{random.choice(styles)}{random.choice(jobs)}"
        advice = random.choice(comments)

    res = f"【称号】：{title}\n【適正】：{score}%\n\n【仙人の一言】：\n{advice}"
    return jsonify({'result': res})
